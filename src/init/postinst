#!/bin/bash
# postinst script
# see: dh_installdeb(1)

set -e

case "${1}" in
	configure)

		! which pihole &> /dev/null && ( echo "error: pihole firmware is missing" & exit 1 )

		if which systemctl &> /dev/null ; then
			systemctl is-enabled pihole-manager pihole-flush &&
				systemctl disable --now pihole-manager.timer pihole-flush.timer

			systemctl enable --now pihole-update-gravity.timer pihole-log-flush.timer \
				pihole-update-firmware.timer || true && systemctl daemon-reload

			which pihole-server-updater &> /dev/null &&
				echo "please run 'apt purge pihole-server-updater'"
		fi

	;;
	abort-upgrade|abort-remove|abort-deconfigure)
	;;
	triggered)
	;;
	*)
		echo "postinst called with unknown argument ${1}" >&2
		exit 1
	;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

exit 0
